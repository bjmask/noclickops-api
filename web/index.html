<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NoClickOps</title>
  <link rel="stylesheet" href="/static/style.css">
</head>

<body>
  <div class="layout-centered">
    <header
      style="position:absolute;top:0;left:0;right:0;padding:24px;display:flex;justify-content:space-between;align-items:center;max-width:1200px;margin:0 auto;width:100%;">
      <div class="brand">
        <div class="brand-icon">N</div>
        <span>NoClickOps</span>
      </div>
      <nav style="display:flex;gap:24px;">
        <a href="/docs.html" class="nav-link">Docs</a>
        <a href="/scanners.html" class="nav-link">Scanners</a>
        <a id="go-dashboard" href="/dashboard.html" class="btn btn-secondary" style="padding:8px 16px;">Dashboard</a>
      </nav>
    </header>

    <div class="hero-section">
      <h1 class="hero-title">See every click.<br>Prove every change.</h1>
      <p class="hero-subtitle">
        Live detection across cloud APIs and Kubernetes audit logs with JIRA signal, not noise.
        Catch ClickOps and ship changes safely.
      </p>

      <div style="display:flex;gap:12px;justify-content:center;margin-bottom:40px;">
        <span class="tag">CloudTrail & Kinesis</span>
        <span class="tag">Kube Audit</span>
        <span class="tag">JIRA Dedupe</span>
      </div>

      <div class="login-box" style="margin:0 auto;">
        <h3 style="margin-bottom:8px;">Sign in</h3>
        <p class="text-muted text-sm mb-4">Access your tenant and manage scanners.</p>
        <form id="login-form">
          <div class="input-group">
            <input type="email" id="email" placeholder="Email" required />
          </div>
          <div class="input-group">
            <input type="password" id="password" placeholder="Password" required />
          </div>
          <button type="submit" class="btn btn-primary" style="width:100%;">Sign in</button>
          <div id="login-error" class="text-sm" style="color:var(--accent-danger);margin-top:12px;display:none;"></div>
        </form>
        <div id="user-chip" class="tag hidden"
          style="margin-top:16px;background:rgba(59,130,246,0.1);color:var(--accent-primary);"></div>
      </div>

      <div class="card" style="margin:40px auto 0;max-width:820px;">
        <h3 style="margin-bottom:12px;">How it works</h3>
        <div id="anim-wrap" style="display:grid;grid-template-columns:1.2fr 0.8fr;gap:16px;align-items:start;">
          <div class="terminal" style="background:#0f1724;border:1px solid rgba(255,255,255,0.05);border-radius:10px;padding:14px;font-family:'SFMono-Regular',Consolas,monospace;font-size:14px;min-height:120px;box-shadow:0 10px 30px rgba(0,0,0,0.25);">
            <div style="color:var(--text-muted);margin-bottom:6px;">kubectl</div>
            <div><span style="color:#6ee7ff;">$</span> <span id="anim-cmd"></span><span id="anim-cursor" style="background:#6ee7ff;color:#0f1724;padding:0 2px;margin-left:1px;">█</span></div>
          </div>
          <div class="card" style="background:#111827;border:1px solid rgba(255,255,255,0.05);border-radius:10px;padding:12px;box-shadow:0 10px 30px rgba(0,0,0,0.25);">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
              <span style="color:var(--text-muted);font-size:0.9rem;">Dashboard</span>
              <span id="anim-status" class="tag">Listening…</span>
            </div>
            <div id="anim-count" style="font-size:32px;font-weight:700;">12</div>
            <div id="anim-log" class="text-muted" style="margin-top:6px;font-size:0.9rem;min-height:22px;">Waiting for activity…</div>
          </div>
        </div>
      </div>
    </div>

    <div class="feature-grid">
      <div class="feature-item">
        <h3>Multi-source ingestion</h3>
        <p class="text-muted">Stream CloudTrail/Kinesis events and Kubernetes audit logs with millisecond polling and
          flexible lookbacks.</p>
      </div>
      <div class="feature-item">
        <h3>Smart suppression</h3>
        <p class="text-muted">Glob-based ignores and per-source filtering keep noisy service accounts from creating
          tickets.</p>
      </div>
      <div class="feature-item">
        <h3>JIRA dedupe</h3>
        <p class="text-muted">Issue creation uses stable hashes to avoid floods, with suppression-aware handling for
          kube audit events.</p>
      </div>
    </div>
  </div>

  <script>
    const loginForm = document.getElementById("login-form");
    const loginError = document.getElementById("login-error");
    const userChip = document.getElementById("user-chip");
    const goDashboard = document.getElementById("go-dashboard");
    const animCmd = document.getElementById("anim-cmd");
    const animCursor = document.getElementById("anim-cursor");
    const animCount = document.getElementById("anim-count");
    const animStatus = document.getElementById("anim-status");
    const animLog = document.getElementById("anim-log");

    let token = localStorage.getItem("noclickops_token") || "";
    let animCountVal = 12;

    function setToken(t) {
      token = t;
      if (t) localStorage.setItem("noclickops_token", t);
      goDashboard.style.opacity = t ? 1 : 0.5;
      goDashboard.style.pointerEvents = t ? "auto" : "none";
    }

    async function api(path, opts = {}) {
      const headers = opts.headers || {};
      if (token) headers["Authorization"] = "Bearer " + token;
      headers["Content-Type"] = "application/json";
      const res = await fetch(path, { ...opts, headers });
      const data = await res.json().catch(() => ({}));
      if (!res.ok) throw data.error || res.statusText;
      return data;
    }

    async function refreshMe() {
      if (!token) {
        goDashboard.style.opacity = 0.5;
        goDashboard.style.pointerEvents = "none";
        return;
      }
      try {
        const me = await api("/v1/me");
        userChip.textContent = "Logged in as " + me.email;
        userChip.classList.remove("hidden");
        goDashboard.style.opacity = 1;
        goDashboard.style.pointerEvents = "auto";
      } catch (err) {
        console.warn(err);
        setToken("");
        userChip.classList.add("hidden");
      }
    }

    loginForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      loginError.style.display = "none";
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value;
      try {
        const res = await api("/v1/login", {
          method: "POST",
          body: JSON.stringify({ email, password }),
          headers: { "Content-Type": "application/json" }
        });
        setToken(res.token);
        window.location.href = "/dashboard.html";
      } catch (err) {
        loginError.textContent = err || "Login failed";
        loginError.style.display = "block";
      }
    });

    refreshMe();

    // Lightweight hero animation: type kubectl, then bump findings.
    const commandText = "kubectl run andres-debug-1 --image=ubuntu -- tail -f /dev/null";
    function typeCommand(text, cb) {
      animCmd.textContent = "";
      let i = 0;
      animCursor.style.opacity = 1;
      const id = setInterval(() => {
        animCmd.textContent = text.slice(0, i);
        i++;
        if (i > text.length) {
          clearInterval(id);
          setTimeout(cb, 300);
        }
      }, 20);
    }
    function pulse(el) {
      el.animate([{ transform: "scale(0.97)" }, { transform: "scale(1)" }], { duration: 250 });
    }
    function runLoop() {
      animStatus.textContent = "Running…";
      animStatus.className = "tag";
      typeCommand(commandText, () => {
        animStatus.textContent = "ClickOps detected";
        animStatus.className = "tag";
        animStatus.style.background = "rgba(99, 102, 241, 0.2)";
        animStatus.style.color = "var(--accent-primary)";
        animCountVal += 1;
        animCount.textContent = animCountVal;
        animLog.textContent = "kubectl run → pod create recorded";
        pulse(animCount);
        setTimeout(() => {
          animStatus.textContent = "Listening…";
          animStatus.style = "";
          setTimeout(runLoop, 1200);
        }, 600);
      });
    }
    setTimeout(runLoop, 500);
  </script>
</body>

</html>
