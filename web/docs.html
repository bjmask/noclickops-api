<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NoClickOps Docs</title>
  <link rel="stylesheet" href="/static/style.css">
  <script src="/static/nav.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
  <style>
    .markdown-body pre {
      background-color: #282c34;
      border-radius: 6px;
      padding: 16px;
      overflow: auto;
    }

    .markdown-body code {
      font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
      font-size: 0.9em;
    }

    .markdown-body p code {
      background-color: rgba(255, 255, 255, 0.1);
      padding: 2px 4px;
      border-radius: 4px;
    }
  </style>
</head>

<body>
  <div class="layout-dashboard">
    <aside>
      <div id="nav-container"></div>

      <div style="margin-top:auto;">
        <button id="logout-btn" class="btn btn-secondary" style="width:100%;">Logout</button>
      </div>
    </aside>

    <main>
      <div class="page-header">
        <div>
          <h1 class="page-title">Documentation</h1>
          <p class="page-desc">Learn how to configure and use NoClickOps.</p>
        </div>
      </div>

      <div class="card" style="min-height:500px;">
        <div id="content" class="markdown-body">Select a document from the sidebar to view.</div>
      </div>
    </main>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/bash.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/json.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/yaml.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/hcl.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/terraform.min.js"></script>
  <script>
    const logoutBtn = document.getElementById("logout-btn");
    mountNav('docs');

    // Configure marked to rely on client-side highlighting
    marked.setOptions({
      langPrefix: 'hljs language-'
    });

    // Ensure Terraform aliases work regardless of whether the definition is named 'hcl' or 'terraform'
    if (window.hljs) {
      const tf = window.hljs.getLanguage('terraform');
      const hcl = window.hljs.getLanguage('hcl');

      if (tf && !hcl) {
        hljs.registerLanguage('hcl', () => tf);
      } else if (hcl && !tf) {
        hljs.registerLanguage('terraform', () => hcl);
        hljs.registerLanguage('tf', () => hcl);
      }
    }

    async function loadDoc(file) {
      try {
        let res = await fetch(`/docs/assets/${file}`);
        if (!res.ok) {
          res = await fetch(`/docs/md/${file}`);
        }
        if (!res.ok) {
          throw new Error(`Failed to load ${file}`);
        }
        const text = await res.text();
        document.getElementById("content").innerHTML = marked.parse(text);
        document.querySelectorAll('pre code').forEach((block) => {
          hljs.highlightElement(block);
        });
      } catch (e) {
        document.getElementById("content").innerHTML = `<div class="text-muted">Failed to load ${file}</div>`;
      }
    }

    function handleHashChange() {
      const hash = window.location.hash.slice(1); // Remove the '#'
      if (hash === 'aws-terraform') {
        loadDoc('aws-terraform.md');
      } else if (hash === 'aws-cli') {
        loadDoc('aws-cli.md');
      } else if (hash === 'gcp-terraform') {
        loadDoc('gcp-terraform.md');
      } else if (hash === 'gcp-cli') {
        loadDoc('gcp-cli.md');
      } else if (hash === 'azure-terraform') {
        loadDoc('azure-terraform.md');
      } else if (hash === 'azure-cli') {
        loadDoc('azure-cli.md');
      } else if (hash === 'aws') {
        // Legacy support - redirect to CLI
        loadDoc('aws-cli.md');
      } else if (hash === 'gcp') {
        loadDoc('gcp.md');
      } else if (hash === 'azure') {
        loadDoc('azure.md');
      } else if (hash) {
        loadDoc(hash);
      }
    }

    // Handle hash changes
    window.addEventListener('hashchange', handleHashChange);

    // Load initial content based on hash
    if (window.location.hash) {
      handleHashChange();
    }

    function redirectToLogin() {
      localStorage.removeItem("noclickops_token");
      window.location.href = "/";
    }

    logoutBtn.addEventListener("click", redirectToLogin);
  </script>
</body>

</html>
